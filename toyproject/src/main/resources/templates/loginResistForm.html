<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<title>펫타그램</title>
<link rel="stylesheet" type="text/css" href="/css/styleregi.css">
	<link rel="stylesheet" type="text/css" href="css/sourcesanspro-font.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="form-v8">
<!--<script type="text/javascript" sec:authorize="isAuthenticated()">-->
<!--	location.href = "/home"-->
<!--</script>-->
<div class="page-content">
	<div class="form-v8-content">
		<div class="form-left">
			<img src="img/form-v8.jpg" alt="form">
		</div>
		<div class="form-right">
			<div class="tab">
				<div class="tab-inner">
					<button class="tablinks" onclick="openCity(event, 'sign-up')" >Sign Up</button>
				</div>
				<div class="tab-inner">
					<button class="tablinks" onclick="openCity(event, 'sign-in')" id="defaultOpen">Sign In</button>
				</div>
			</div>
			<form class="form-detail" action="/resistResult" id="register" method="post">
				<div class="tabcontent" id="sign-up">
					<div class="form-row">
						<label class="form-row-inner">
							<input type="text" name="uid" id=userId class="input-text" required>
							<span class="label">UserID</span>
							<span class="border"></span>
						</label>
					</div>
					<div class="form-row">
						<label class="form-row-inner">
							<input type="password" name="upw" id="userpw" class="input-text" required>
							<span class="label">Password</span>
							<span class="border"></span>
						</label>
					</div>
					<div class="form-row">
						<label class="form-row-inner">
							<input type="password" name="upw2" id="userpw2" class="input-text" required>
							<span class="label">Comfirm Password</span>
							<span class="border"></span>
						</label>
					</div>
					<div class="form-row">
						<label class="form-row-inner">
							<input type="text" name="uname" class="input-text" required>
							<span class="label">Username</span>
							<span class="border"></span>
						</label>
					</div>
					<div class="form-row">
						<label class="form-row-inner">
							<input type="text" name="uemail" class="input-text" required>
							<span class="label">E-mail</span>
							<span class="border"></span>
						</label>
					</div>

					<input type="hidden" id="csrfregi" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
					<div class="form-row-last">
						<input type="submit" id="reg_submit" name="register" class="register" value="Register">
					</div>
					<div class="checkbox">
					<input type="checkbox" name="roles[0].rolename" value="BASIC" >BASIC
					<input type="checkbox" name="roles[1].rolename" value="MANAGER" >MANAGER
					<input type="checkbox" name="roles[2].rolename" value="ADMIN" >ADMIN
					</div>
					<div class="check_font" id="id_check"></div>
					<div class="check_font" id="pw_check"></div>
				</div>
			</form>
			<form class="form-detail" id="login" method="post">
				<div th:if="${errorMessage != null}">
					<h2 th:text="${errorMessage}"></h2>
				</div>
				<div th:if="${param.logout !=null}">
					<h2 th:text="${errorMessage}"></h2>
				</div>
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<div class="tabcontent" id="sign-in">
					<div class="form-row">
						<label class="form-row-inner">
							<input type="text" name="username" id="username" class="input-text" required>
							<span class="label">UserID</span>
							<span class="border"></span>
						</label>
					</div>

					<div class="form-row">
						<label class="form-row-inner">
							<input type="password" name="password" id="password" class="input-text" required>
							<span class="label">Password</span>
							<span class="border"></span>
						</label>
					</div>


					<div class="form-row-last">
						<input type="submit" name="register" class="register" value="Sign In">
					</div>

				</div>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript">
	function openCity(evt, cityName) {
		var i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		document.getElementById(cityName).style.display = "block";
		evt.currentTarget.className += " active";
	}

	// Get the element with id="defaultOpen" and click on it
	document.getElementById("defaultOpen").click();
</script>
	
	<script>
		var x = document.getElementById("login");
		var y = document.getElementById("register");
		var z = document.getElementById("btn");

		function login() {
			x.style.left = "50px";
			y.style.left = "450px";
			z.style.left = "0";
		}

		function register() {
			x.style.left = "-400px";
			y.style.left = "50px";
			z.style.left = "110px";
		}
	</script>
	<script>
	$("#home1").on("click", function(){
		location.href="home";
	});

	$("#home2").on("click", function(){
		location.href="home";
	});
	
// 아이디 유효성 검사(1 = 중복 / 0 != 중복)
	$("#userId").blur(function() {
		var userId = $('#userId').val();
		$.ajax({
			url : 'loginResistForm/idCheck?uid='+ userId, 
			type : 'get',
			success : function(data) {
				
									
				
				if (data == 1) {
						// 1 : 아이디가 중복되는 문구
						$("#id_check").text("사용중인 아이디입니다.");
						$("#id_check").css("color", "red");
						$("#reg_submit").attr("disabled", true);
					}
				else {
						if(userId == ""){
							$('#id_check').text('아이디를 입력해주세요');
							$('#id_check').css('color', 'red');
							$("#reg_submit").attr("disabled", true);				
						} 
						else{
							$('#id_check').text('가입가능한 아이디입니다.');
							$('#id_check').css('color', 'green');
							$("#reg_submit").attr("disabled", false);	
							
						}
					}
				}, error : function() {
						console.log("실패");
				}
			});
		});
</script>
<script>
// 패스워드 유효성 검사 같으면 0 다르면 1
	$("#userpw2").blur(function() {
		var userpw1 = $('#userpw').val();
		var userpw2 = $('#userpw2').val();
		var csrf = $('#csrfregi').val();
		console.log('check')
		console.log(csrf)
		$.ajax({
			url : 'loginResistForm/pwCheck' , 
			type : 'post',
			data : {
				'upw' : userpw1 , 'upw2' : userpw2,
				'_csrf' : csrf
			},
			success : function(data) {
				
				if (data == 1) {
						// 1 : 다르면
						$("#pw_check").text("비밀번호가 서로 다릅니다.");
						$("#pw_check").css("color", "red");
						$("#reg_submit").attr("disabled", true);
					}
				else {
							$('#pw_check').text('비밀번호가 일치합니다.');
							$('#pw_check').css('color', 'green');
							$("#reg_submit").attr("disabled", false);	
					}
				}, error : function(err) {
						console.log("실패");
						console.log(err);
				}
			});
		});
</script>

</body>
</html>